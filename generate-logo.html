<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Manhattan Runs Logo Generator</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
        }
        
        #container {
            position: relative;
            width: 1400px;
            height: 500px;
            background: black;
        }
        
        #map {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        #text-canvas {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        button {
            padding: 10px 20px;
            background: #FC4C02;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        
        button:hover {
            background: #E63C00;
        }
        
        input[type="range"] {
            width: 200px;
        }
        
        label {
            color: white;
        }
        
        #preview {
            margin-top: 20px;
            border: 2px solid #333;
            display: none;
        }
    </style>
</head>
<body>
    <h1 style="color: white;">Manhattan Runs Logo Generator</h1>
    
    <div id="container">
        <div id="map"></div>
        <canvas id="text-canvas" width="1400" height="500"></canvas>
    </div>
    
    <div class="controls">
        <label>
            Font Size: 
            <input type="range" id="fontSize" min="100" max="200" value="140">
            <span id="fontSizeValue">140</span>
        </label>
        <label>
            Letter Spacing: 
            <input type="range" id="letterSpacing" min="-20" max="40" value="-5">
            <span id="letterSpacingValue">-5</span>
        </label>
        <button onclick="resetView()">Reset View</button>
        <button onclick="captureImage()">Download as PNG</button>
    </div>
    
    <canvas id="preview"></canvas>

    <script>
        // Replace with your Mapbox token
        mapboxgl.accessToken = 'pk.eyJ1IjoidGhvdWxkZW4iLCJhIjoiY21jczl5Y3VqMTAweTJrczN5ajlpcXY2ciJ9.51bpDEgJ0f0i8QF-2Tlxtg';
        
        const map = new mapboxgl.Map({
            container: 'map',
            style: {
                'version': 8,
                'sources': {
                    'composite': {
                        'type': 'vector',
                        'url': 'mapbox://mapbox.mapbox-streets-v8'
                    }
                },
                'layers': [
                    {
                        'id': 'background',
                        'type': 'background',
                        'paint': {
                            'background-color': '#000000'
                        }
                    }
                ]
            },
            center: [-73.9712, 40.7831],
            zoom: 11.5,
            bearing: 117,  // Match your main map rotation
            pitch: 0,
            interactive: true  // Allow adjusting the view
        });

        map.on('load', () => {
            // Add Manhattan boundary if you have it
            fetch('manhattan-boundary.json')
                .then(response => response.json())
                .then(data => {
                    let boundary = data;
                    if (data.type === 'FeatureCollection') {
                        boundary = data.features[0];
                    }
                    
                    map.addSource('manhattan-boundary', {
                        'type': 'geojson',
                        'data': boundary
                    });
                })
                .catch(err => console.log('No boundary file found'));
            
            // Add all road types with your styling
            map.addLayer({
                'id': 'roads-primary',
                'type': 'line',
                'source': 'composite',
                'source-layer': 'road',
                'filter': ['==', 'class', 'primary'],
                'layout': {
                    'line-join': 'round',
                    'line-cap': 'round'
                },
                'paint': {
                    'line-color': '#ffffff',
                    'line-width': {
                        'base': 1.5,
                        'stops': [
                            [11, 1.5],
                            [14, 3],
                            [16, 6]
                        ]
                    }
                }
            });

            map.addLayer({
                'id': 'roads-secondary',
                'type': 'line',
                'source': 'composite',
                'source-layer': 'road',
                'filter': ['in', 'class', 'secondary', 'tertiary'],
                'layout': {
                    'line-join': 'round',
                    'line-cap': 'round'
                },
                'paint': {
                    'line-color': '#cccccc',
                    'line-width': {
                        'base': 1.5,
                        'stops': [
                            [11, 1],
                            [14, 2],
                            [16, 4]
                        ]
                    }
                }
            });

            map.addLayer({
                'id': 'roads-street',
                'type': 'line',
                'source': 'composite',
                'source-layer': 'road',
                'filter': ['in', 'class', 'street', 'street_limited'],
                'minzoom': 11,
                'layout': {
                    'line-join': 'round',
                    'line-cap': 'round'
                },
                'paint': {
                    'line-color': '#999999',
                    'line-width': {
                        'base': 1.5,
                        'stops': [
                            [11, 0.5],
                            [14, 1],
                            [16, 2]
                        ]
                    }
                }
            });
            
            // Draw the text mask on canvas
            drawTextMask();
        });

        // Draw text mask using canvas
        function drawTextMask() {
            const canvas = document.getElementById('text-canvas');
            const ctx = canvas.getContext('2d');
            
            // Fill with black
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, 1400, 500);
            
            // Set composite operation to cut out text
            ctx.globalCompositeOperation = 'destination-out';
            
            // Draw text (this will cut holes in the black)
            ctx.font = 'bold 140px Arial Black';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('MANHATTAN', 700, 200);
            
            ctx.font = 'bold 180px Arial Black';
            ctx.fillText('RUNS', 700, 375);
        }

        // Controls for adjusting text
        let fontSize = 140;
        let letterSpacing = -5;
        
        document.getElementById('fontSize').addEventListener('input', (e) => {
            fontSize = parseInt(e.target.value);
            document.getElementById('fontSizeValue').textContent = fontSize;
            drawTextMask();
        });

        document.getElementById('letterSpacing').addEventListener('input', (e) => {
            letterSpacing = parseInt(e.target.value);
            document.getElementById('letterSpacingValue').textContent = letterSpacing;
            drawTextMask();
        });
        
        // Redraw text mask with current settings
        function drawTextMask() {
            const canvas = document.getElementById('text-canvas');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, 1400, 500);
            
            // Fill with black
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, 1400, 500);
            
            // Set composite operation to cut out text
            ctx.globalCompositeOperation = 'destination-out';
            
            // Draw text (this will cut holes in the black)
            ctx.font = `bold ${fontSize}px Arial Black`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.letterSpacing = `${letterSpacing}px`;
            ctx.fillText('MANHATTAN', 700, 200);
            
            ctx.font = `bold ${fontSize * 1.3}px Arial Black`;
            ctx.letterSpacing = `${letterSpacing * 4}px`;
            ctx.fillText('RUNS', 700, 375);
        }

        function resetView() {
            map.jumpTo({
                center: [-73.9712, 40.7831],
                zoom: 11.5,
                bearing: 117,
                pitch: 0
            });
        }

        async function captureImage() {
            // Hide controls temporarily
            const overlay = document.getElementById('text-overlay');
            overlay.style.zIndex = '1000';
            
            // Use html2canvas to capture the container
            const container = document.getElementById('container');
            const canvas = await html2canvas(container, {
                backgroundColor: '#000000',
                scale: 2,  // Higher quality
                logging: false,
                useCORS: true
            });
            
            // Create download link
            const link = document.createElement('a');
            link.download = 'manhattan-runs-logo.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
            
            // Show preview
            const preview = document.getElementById('preview');
            preview.style.display = 'block';
            preview.width = 700;
            preview.height = 250;
            const ctx = preview.getContext('2d');
            ctx.drawImage(canvas, 0, 0, 700, 250);
            
            // Reset overlay
            overlay.style.zIndex = '10';
        }
    </script>
</body>
</html>
