<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Manhattan Roads - Black Background</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.js"></script>
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            background: #000;
        }
        #map { 
            position: absolute; 
            top: 0; 
            bottom: 0; 
            width: 100%; 
        }
    </style>
</head>
<body>
<div id="map"></div>
<script>
    // You'll need to replace this with your own Mapbox access token
    mapboxgl.accessToken = 'pk.eyJ1IjoidGhvdWxkZW4iLCJhIjoiY21jczl5Y3VqMTAweTJrczN5ajlpcXY2ciJ9.51bpDEgJ0f0i8QF-2Tlxtg';
    
    // More precise Manhattan boundary coordinates
    const manhattanBoundary = {
        'type': 'Feature',
        'geometry': {
            'type': 'Polygon',
            'coordinates': [[
                // Southern tip - Battery Park
                [-74.0194, 40.6982],
                [-74.0170, 40.6990],
                [-74.0135, 40.7010],
                [-74.0118, 40.7027],
                [-74.0090, 40.7042],
                [-74.0060, 40.7055],
                
                // East River - Lower East Side
                [-74.0020, 40.7080],
                [-73.9980, 40.7115],
                [-73.9950, 40.7150],
                [-73.9920, 40.7200],
                [-73.9890, 40.7250],
                [-73.9850, 40.7300],
                [-73.9820, 40.7350],
                [-73.9780, 40.7400],
                [-73.9750, 40.7450],
                [-73.9730, 40.7500],
                
                // East River - Midtown
                [-73.9710, 40.7550],
                [-73.9680, 40.7600],
                [-73.9650, 40.7650],
                [-73.9620, 40.7700],
                [-73.9590, 40.7750],
                [-73.9560, 40.7800],
                
                // East River - Upper East Side
                [-73.9530, 40.7850],
                [-73.9500, 40.7900],
                [-73.9470, 40.7950],
                [-73.9440, 40.8000],
                [-73.9420, 40.8050],
                [-73.9400, 40.8100],
                [-73.9380, 40.8150],
                [-73.9360, 40.8200],
                
                // East River - East Harlem to Harlem River
                [-73.9340, 40.8250],
                [-73.9320, 40.8300],
                [-73.9300, 40.8350],
                [-73.9280, 40.8400],
                [-73.9260, 40.8450],
                [-73.9240, 40.8500],
                [-73.9220, 40.8550],
                
                // Harlem River - turn at top
                [-73.9180, 40.8600],
                [-73.9150, 40.8650],
                [-73.9118, 40.8687],
                
                // Northern tip - Inwood
                [-73.9110, 40.8720],
                [-73.9115, 40.8750],
                [-73.9150, 40.8780],
                [-73.9200, 40.8790],
                [-73.9250, 40.8785],
                [-73.9300, 40.8770],
                
                // Hudson River - Inwood
                [-73.9337, 40.8719],
                [-73.9380, 40.8680],
                [-73.9420, 40.8640],
                [-73.9450, 40.8600],
                [-73.9480, 40.8550],
                
                // Hudson River - Washington Heights
                [-73.9500, 40.8500],
                [-73.9520, 40.8450],
                [-73.9540, 40.8400],
                [-73.9560, 40.8350],
                [-73.9580, 40.8300],
                
                // Hudson River - Upper West Side
                [-73.9600, 40.8250],
                [-73.9620, 40.8200],
                [-73.9640, 40.8150],
                [-73.9660, 40.8100],
                [-73.9680, 40.8050],
                [-73.9700, 40.8000],
                [-73.9720, 40.7950],
                [-73.9740, 40.7900],
                [-73.9760, 40.7850],
                
                // Hudson River - Midtown West
                [-73.9780, 40.7800],
                [-73.9800, 40.7750],
                [-73.9820, 40.7700],
                [-73.9840, 40.7650],
                [-73.9860, 40.7600],
                [-73.9880, 40.7550],
                [-73.9900, 40.7500],
                [-73.9920, 40.7450],
                
                // Hudson River - Chelsea/West Village
                [-73.9950, 40.7400],
                [-73.9980, 40.7350],
                [-74.0010, 40.7300],
                [-74.0040, 40.7250],
                [-74.0070, 40.7200],
                [-74.0100, 40.7150],
                
                // Hudson River - Tribeca/Financial District
                [-74.0130, 40.7100],
                [-74.0150, 40.7050],
                [-74.0170, 40.7000],
                [-74.0194, 40.6982]
            ]]
        }
    };
    
    const map = new mapboxgl.Map({
        container: 'map',
        style: {
            'version': 8,
            'sources': {
                'composite': {
                    'type': 'vector',
                    'url': 'mapbox://mapbox.mapbox-streets-v8'
                }
            },
            'layers': [
                {
                    'id': 'background',
                    'type': 'background',
                    'paint': {
                        'background-color': '#000000'
                    }
                }
            ]
        },
        center: [-73.9712, 40.7831], // Manhattan center
        zoom: 12,
        minZoom: 10,
        maxZoom: 14
    });

    map.on('load', () => {
        // Add Manhattan boundary source
        map.addSource('manhattan-boundary', {
            'type': 'geojson',
            'data': manhattanBoundary
        });

        // Optional: Add a subtle outline of Manhattan
        map.addLayer({
            'id': 'manhattan-outline',
            'type': 'line',
            'source': 'manhattan-boundary',
            'paint': {
                'line-color': '#333333',
                'line-width': 1
            }
        });

        // Add road layers directly without complex filtering
        
        // Secondary roads only (no highways or primary roads)
        map.addLayer({
            'id': 'roads-secondary',
            'type': 'line',
            'source': 'composite',
            'source-layer': 'road',
            'filter': ['in', 'class', 'secondary', 'secondary_link', 'tertiary', 'tertiary_link'],
            'layout': {
                'line-join': 'round',
                'line-cap': 'round'
            },
            'paint': {
                'line-color': '#999999',
                'line-width': {
                    'base': 1.5,
                    'stops': [
                        [11, 1],
                        [14, 2],
                        [16, 4]
                    ]
                }
            }
        });

        // Streets
        map.addLayer({
            'id': 'roads-street',
            'type': 'line',
            'source': 'composite',
            'source-layer': 'road',
            'filter': ['in', 'class', 'street', 'street_limited', 'service', 'track'],
            'minzoom': 12,
            'layout': {
                'line-join': 'round',
                'line-cap': 'round'
            },
            'paint': {
                'line-color': '#666666',
                'line-width': {
                    'base': 1.5,
                    'stops': [
                        [12, 0.5],
                        [14, 1],
                        [16, 2]
                    ]
                }
            }
        });

        // Add a mask to hide everything outside Manhattan
        map.addLayer({
            'id': 'mask-outside-manhattan',
            'type': 'fill',
            'source': {
                'type': 'geojson',
                'data': {
                    'type': 'Feature',
                    'geometry': {
                        'type': 'Polygon',
                        'coordinates': [
                            // Outer ring - large box covering the whole view
                            [
                                [-74.5, 40.4],
                                [-74.5, 41.0],
                                [-73.4, 41.0],
                                [-73.4, 40.4],
                                [-74.5, 40.4]
                            ],
                            // Inner ring - Manhattan boundary (creates a hole)
                            manhattanBoundary.geometry.coordinates[0]
                        ]
                    }
                }
            },
            'paint': {
                'fill-color': '#000000',
                'fill-opacity': 1
            }
        });

        // Fit map to Manhattan bounds with padding
        const bounds = [
            [-74.02, 40.69], // Southwest
            [-73.91, 40.88]  // Northeast
        ];
        
        map.fitBounds(bounds, {
            padding: 50
        });
    });
</script>
</body>
</html>
